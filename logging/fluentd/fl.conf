<source>
  @type forward
  port 24224
  bind 0.0.0.0
  # <parse>
  #   @type multiline_grok
  #   grok_pattern service=%{WORD:service} \| event=%{WORD:event} \| request_id=%{GREEDYDATA:request_id} \| message='%{GREEDYDATA:message}'
  #   multiline_start_regexp /^[^\s]/
  # </parse>
</source>

# <filter service.post>
#   @type parser
#   format json
#   key_name log
# </filter>



# <filter service.ui>
#   @type parser
#   <parse>
#     @type multiline_grok
#     grok_pattern service=%{WORD:service} \| event=%{WORD:event} \| request_id=%{GREEDYDATA:request_id} \| message='%{GREEDYDATA:message}'
#     multiline_start_regexp /^[^\s]/
#   </parse>
# </filter>

<match *.**>
  @type copy

  <buffer>
    flush_interval 1s
  </buffer>

  <store>
    @type elasticsearch
    host elasticsearch
    port 9200
    logstash_format true
    logstash_prefix fluentd
    logstash_dateformat %Y%m%d
    include_tag_key true
    type_name access_log
    tag_key @log_name
  </store>

  <store>
    @type stdout
  </store>
</match>
